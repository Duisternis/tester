<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Browser Storage & Cache Test</title>

  <!-- Cacheable resource for FUNC-043 -->
  <link rel="stylesheet" href="style.css">

  <style>
    body {
      background: #000;
      color: #fff;
      font-family: system-ui, sans-serif;
      padding: 40px;
    }

    h2 {
      margin-top: 40px;
    }

    button {
      margin-right: 10px;
      margin-top: 10px;
      padding: 8px 14px;
      cursor: pointer;
    }

    .box {
      margin-top: 10px;
      padding: 10px;
      background: #111;
      border: 1px solid #444;
      min-height: 20px;
    }
  </style>
</head>
<body>

  <h1>Browser Core Storage Test</h1>

  <!-- ================= FUNC-041 ================= -->
  <h2>FUNC-041 — sessionStorage</h2>

  <button onclick="storeSession()">Store session value</button>
  <button onclick="clearSession()">Clear session</button>

  <div id="sessionBox" class="box"></div>

  <!-- ================= FUNC-042 ================= -->
  <h2>FUNC-042 — IndexedDB</h2>

  <button onclick="writeDB()">Write IndexedDB</button>
  <button onclick="readDB()">Read IndexedDB</button>
  <button onclick="clearDB()">Clear IndexedDB</button>

  <div id="dbBox" class="box"></div>

  <!-- ================= FUNC-043 ================= -->
  <h2>FUNC-043 — Cache behavior</h2>

  <div id="cacheBox" class="box">
    If this page reloads fast and does NOT refetch static assets, cache works.
  </div>

  <script>
    /* ================= FUNC-041: sessionStorage ================= */
    function storeSession() {
      sessionStorage.setItem("func041", "session_value");
      updateSessionBox();
    }

    function clearSession() {
      sessionStorage.removeItem("func041");
      updateSessionBox();
    }

    function updateSessionBox() {
      document.getElementById("sessionBox").innerText =
        sessionStorage.getItem("func041") || "No session value";
    }

    updateSessionBox();

    /* ================= FUNC-042: IndexedDB ================= */
    let db;

    const request = indexedDB.open("FUNC042_DB", 1);

    request.onupgradeneeded = event => {
      db = event.target.result;
      db.createObjectStore("data", { keyPath: "id" });
    };

    request.onsuccess = event => {
      db = event.target.result;
    };

    function writeDB() {
      const tx = db.transaction("data", "readwrite");
      tx.objectStore("data").put({ id: 1, value: "indexeddb_value" });
      document.getElementById("dbBox").innerText = "Data written to IndexedDB";
    }

    function readDB() {
      const tx = db.transaction("data", "readonly");
      const req = tx.objectStore("data").get(1);
      req.onsuccess = () => {
        document.getElementById("dbBox").innerText =
          req.result ? req.result.value : "No IndexedDB data";
      };
    }

    function clearDB() {
      const tx = db.transaction("data", "readwrite");
      tx.objectStore("data").clear();
      document.getElementById("dbBox").innerText = "IndexedDB cleared";
    }
  </script>

</body>
</html>
